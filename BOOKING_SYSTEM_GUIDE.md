# 📅 포토부스 예약 시스템 설정 가이드

## 🚀 완료된 작업

### 1. **백엔드 (API & 구글 시트 연동)**
- ✅ 구글 시트 자동 초기화 API (`/api/booking/setup`)
- ✅ 예약 가능한 날짜 조회 API (`/api/booking/dates?month=2026-02`)
- ✅ 특정 날짜의 예약 가능한 시간 조회 API (`/api/booking/times?date=2026-02-15`)
- ✅ 기존 리드 API에 예약 정보 추가 (`bookingDate`, `bookingTime`, `status`)
- ✅ 이메일 알림에 예약 정보 포함

### 2. **프론트엔드 (UI 컴포넌트)**
- ✅ 달력 컴포넌트 (`BookingCalendar.tsx`)
  - 월별 날짜 표시
  - 예약 가능/마감 상태 표시
  - 날짜 선택 기능
- ✅ 시간 선택 바텀시트 (`TimeSlotSheet.tsx`)
  - 선택한 날짜의 가능한 시간대 표시
  - 시간 선택 UI
- ✅ LeadFlow 3단계 구조
  - **Step 1**: 이름, 연락처 입력
  - **Step 2**: 예약 날짜/시간 선택 (달력)
  - **Step 3**: 추가 정보 (지역, 문의내용 - 선택사항)

### 3. **구글 시트 구조**
- ✅ **"예약가능시간" 시트** (자동 생성)
  - 날짜 | 시간슬롯
  - 관리자가 여기서 날짜별 시간대 설정
- ✅ **기존 리드 시트** (헤더 확장)
  - 타임스탬프 | 이름 | 연락처 | 지역 | **예약날짜** | **예약시간** | 문의내용 | UserAgent | Referer | **상태** | **관리자메모**

---

## 📋 설치 및 실행 방법

### **Step 1: 구글 시트 자동 설정**

브라우저에서 아래 URL을 **한 번만** 방문하세요:

```
http://localhost:3000/api/booking/setup
```

**결과:**
```json
{
  "ok": true,
  "message": "예약 시스템 시트가 성공적으로 설정되었습니다."
}
```

이렇게 하면 자동으로:
1. "예약가능시간" 시트 생성
2. 향후 2주간의 예시 데이터 입력 (10:00~20:00, 2시간 간격)
3. 기존 리드 시트에 헤더 추가

### **Step 2: 애플리케이션 실행**

```powershell
npm run dev
# 또는
pnpm dev
```

### **Step 3: 테스트**

1. 메인 페이지에서 "신청하기" 버튼 클릭
2. **Step 1**: 이름, 연락처 입력
3. **Step 2**: 달력에서 날짜 선택 → 시간 선택
4. **Step 3**: 추가 정보 입력 (선택사항)
5. 동의 후 신청 완료

---

## 🎨 UI 디자인

### **달력 (Step 2)**
- **흰색 + 파란 테두리**: 예약 가능한 날
- **보라색 + "마감"**: 모든 시간대가 예약된 날
- **회색**: 과거 날짜 또는 예약 불가능한 날

### **시간 선택 바텀시트**
- 날짜 클릭 시 하단에서 올라옴
- 예약 가능한 시간만 버튼으로 표시
- 선택 후 "확인" 버튼

---

## 🔧 관리자 작업

### **예약 시간 설정 (구글 시트)**

1. 구글 시트 열기
2. **"예약가능시간"** 시트로 이동
3. 날짜와 시간슬롯 입력

**예시:**
| 날짜 | 시간슬롯 |
|------|---------|
| 2026-02-15 | 10:00,12:00,14:00,16:00,18:00,20:00 |
| 2026-02-16 | 14:00,16:00,18:00 |
| 2026-02-20 | 10:00,12:00 |

**형식:**
- 날짜: `YYYY-MM-DD`
- 시간: 쉼표로 구분, 24시간 형식 (`HH:MM`)

### **예약 확정/거부 (구글 시트)**

1. 리드 시트에서 신청 내역 확인
2. **상태** 컬럼을 수정:
   - `대기` → `확정` (예약 확정)
   - `대기` → `거부` (예약 거부)
3. **관리자메모** 컬럼에 메모 추가 (선택사항)

**중요:**
- 상태가 `확정` 또는 `대기`인 예약은 해당 시간대를 차단합니다
- 다른 사용자는 해당 시간을 선택할 수 없습니다

---

## 🔍 API 테스트

### **1. 예약 가능한 날짜 조회**
```
GET http://localhost:3000/api/booking/dates?month=2026-02
```

**응답:**
```json
{
  "ok": true,
  "dates": [
    { "date": "2026-02-15", "status": "available" },
    { "date": "2026-02-16", "status": "partial" },
    { "date": "2026-02-17", "status": "full" }
  ]
}
```

### **2. 특정 날짜의 예약 가능한 시간 조회**
```
GET http://localhost:3000/api/booking/times?date=2026-02-15
```

**응답:**
```json
{
  "ok": true,
  "slots": ["10:00", "14:00", "18:00", "20:00"]
}
```

---

## 💡 예약 로직

### **예약 가능 여부 판단:**

1. "예약가능시간" 시트에 해당 날짜가 있는가? ❌ → **불가능**
2. 해당 날짜의 시간슬롯 가져오기
3. 리드 시트에서 해당 날짜에 `대기` 또는 `확정` 상태인 예약 찾기
4. 이미 예약된 시간을 제외한 시간만 표시

### **중복 예약 방지:**
- 같은 날짜/시간에 `대기` 또는 `확정` 상태인 예약이 있으면
- 다른 사용자는 해당 시간을 선택할 수 없음

---

## 📝 Google Apps Script 수정 (필요 시)

현재는 **Google Sheets API**를 직접 사용하므로 Google Apps Script 수정이 **필요 없습니다**.

만약 기존 Apps Script를 사용 중이라면, 데이터 구조에 맞게 업데이트하세요:

```javascript
// Apps Script에서 받는 데이터
{
  name: "홍길동",
  phone: "010-1234-5678",
  region: "강남구",
  message: "생일파티",
  bookingDate: "2026-02-15",  // 추가
  bookingTime: "16:00",       // 추가
  createdAt: "2026-02-02T..."
}
```

---

## 🎯 다음 단계 (선택사항)

### **추가 기능 아이디어:**
1. **사용자 예약 확인 페이지**
   - 전화번호로 본인의 예약 조회
   - 예약 취소 기능

2. **관리자 대시보드**
   - `/admin/bookings` 페이지
   - 캘린더 뷰로 예약 현황 확인
   - UI로 예약 확정/거부 처리

3. **자동 알림**
   - 예약 확정 시 SMS/이메일 발송
   - 예약 전날 리마인더

4. **대기자 명단**
   - 원하는 시간이 없을 때 대기자 등록
   - 취소 발생 시 자동 알림

---

## ⚠️ 주의사항

1. **시간대 형식**: 반드시 `HH:MM` 형식 (예: `09:00`, `14:30`)
2. **날짜 형식**: 반드시 `YYYY-MM-DD` 형식
3. **상태 값**: `대기`, `확정`, `거부`, `취소`만 사용
4. **첫 실행 시**: `/api/booking/setup` 반드시 한 번 호출

---

## 🐛 문제 해결

### **달력에 날짜가 안 보여요**
→ "예약가능시간" 시트에 날짜를 추가하세요

### **시간 선택이 안 돼요**
→ 해당 날짜에 시간슬롯이 설정되어 있는지 확인하세요

### **예약이 안 돼요**
→ 브라우저 콘솔과 서버 로그를 확인하세요

---

## ✅ 완료!

이제 포토부스 예약 시스템이 완벽하게 작동합니다! 🎉

문의사항이 있으면 언제든 알려주세요!
